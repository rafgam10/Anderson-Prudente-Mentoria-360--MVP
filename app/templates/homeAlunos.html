{% extends "baseAlunos.html" %}

{% block title %}Mentoria 360° - Aluno{% endblock %}
{% block navbar_title %}Meus cursos{% endblock %}

{% block nome %} 
    {{ aluno.nomeAluno }}
{% endblock %}

{% block eventos %}
    {% for evento in eventos %}
                        <!-- Exemplo evento 1 -->
                        <div class="card-evento text-gray-300 bg-[#1a1a1a] rounded-lg border border-[#2a2a2a] transition-colors hover:border-[#f8ca54]">        
                            <div class="rounded-t-lg px-4 py-3 gap-2 bg-[#242424] flex justify-between items-center">
                                <div class="flex justify-center items-center gap-2 text-lg font-bold text-[#f8ca54]">
                                    <i class="ph-duotone ph-calendar text-2xl"></i>
                                    <span>{{evento.nomeEvento}}</span>
                                </div>
                            </div>

                            <div class="p-4">
                                <div class="flex flex-col lg:flex-row gap-6">
                                    <div class="flex-1 space-y-2">
                                        <p class="text-sm text-[#f8ca54]"><i class="ph ph-calendar-blank"></i> Data Inicial</p>
                                        <p class="text-sm font-medium">{{evento.dataInicial.strftime("%d/%m/%Y")}} - 14:30</p>
                                    </div>
                                    <div class="flex-1 space-y-2">
                                        <p class="text-sm text-[#f8ca54]"><i class="ph ph-calendar-blank"></i> Data Final</p>
                                        <p class="text-sm font-medium">{{evento.dataFinal.strftime("%d/%m/%Y")}} - 16:45</p>
                                    </div>
                                    <div class="flex-1 space-y-2">
                                        <p class="text-sm text-[#f8ca54]"><i class="ph ph-microphone-stage"></i> Palestrante</p>
                                        <p class="text-sm font-medium">{{evento.nomePalestrante}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>

    {% endfor %}
{% endblock %}

{% block content %}

<div class="px-8 py-7 sm:px-10 sm:py-8 text-center">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-9 justify-center">

        <!-- Card desbloqueado 1 -->
        {% for curso in desbloqueados %}
            <div class="bg-[#171717] border border-[#2a2a2a] hover:border-gray-500 rounded-lg p-0 flex items-center justify-center overflow-hidden">
                <a onclick="openMindmap('{{ curso.nomeProduto }}')"
                    class="w-full h-full p-0 m-0 border-none bg-transparent cursor-pointer">
                    <img src="{{ url_for('static', filename='img/capa-' ~ curso.nomeProduto|lower ~ '.webp') }}" 
                        alt="{{ curso.nomeProduto }}" 
                        class="w-full h-full object-cover">
                </a>
            </div>
        {% endfor %}

        <!-- Cursos bloqueados -->
        {% for curso in bloqueados %}
            <div class="relative bg-[#171717] border border-[#2a2a2a] rounded-lg p-0 flex items-center justify-center overflow-hidden group">
                <a class="w-full h-full p-0 m-0 border-none bg-transparent cursor-pointer">
                    <img src="{{ url_for('static', filename='img/capa-' ~ curso.nomeProduto|lower ~ '.webp') }}" 
                        alt="{{ curso.nomeProduto }}" 
                        class="w-full h-full object-cover">
                </a>
                <div class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center">
                    <div class="anim flex flex-col items-center justify-center">
                        <i class="ph-duotone text-5xl ph-lock text-white"></i>
                        <b class="text-white">Este conteúdo está bloqueado.</b>
                        <span class="text-sm text-gray-300">Para desbloqueá-lo, clique em saiba mais.</span>
                        <button onclick="openModal()"
                                class="my-4 px-4 py-2 bg-white text-black rounded-md text-sm font-medium hover:bg-gray-300">
                            Saiba mais
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>


<div id="mindmapModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-xl w-[95%] max-w-5xl h-[80%] relative flex p-2 flex-col">

        <button onclick="closeMindmap()" class="absolute top-2 right-4 text-gray-600 hover:text-black text-2xl">
            ✕
        </button>

        <div class="flex-1">
            <iframe id="mindmapFrame" src="" class="w-full h-full rounded-b-xl border-none"></iframe>
        </div>
    </div>
</div>

<div id="infoModal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
    <div class="bg-white text-black rounded-xl shadow-xl max-w-md w-[90%] p-6 relative">
        <button onclick="closeModal()" class="absolute top-2 right-3.5 text-gray-600 hover:text-black">
            ✕
        </button>
        <h2 class="text-xl font-bold mb-3">Conteúdo Bloqueado</h2>
        <p class="text-gray-700 mb-4">
            Para acessar este curso, é necessário desbloqueá-lo. Entre em contato com nosso suporte ou
            verifique os planos disponíveis.
        </p>
        <a href="https://andersonprudente.com.br/"
            class="w-full flex items-center justify-center py-2 px-4 bg-black text-white rounded-lg hover:bg-gray-800">
            Ver planos
        </a>
    </div>
</div>





<!-- Modal de Atividades para o Aluno -->
<div id="atividadesModal" class="fixed inset-0 bg-[#00000084] hidden flex items-center justify-center z-50 p-4">
    <div class="bg-[#171717] w-full max-w-4xl rounded-lg border border-[#2a2a2a] max-h-[90vh] overflow-hidden">
        <div class="p-6 border-b border-[#2a2a2a]">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold text-[#f8ca54]" id="modalTitulo">Minhas Atividades</h2>
                <button onclick="closeAtividadesModal()" class="text-gray-400 hover:text-white">
                    <i class="ph ph-x text-2xl"></i>
                </button>
            </div>
        </div>
        
        <div class="p-6 overflow-y-auto max-h-[70vh] space-y-4">
            
            {% for atividade in atividades_mps %}
                <!-- Atividade 1 - MPS -->
                <div class="card-atividade text-gray-300 bg-[#1a1a1a] rounded-lg border border-[#2a2a2a] transition-colors hover:border-[#f8ca54]">        
                    <div class="rounded-t-lg px-4 py-3 gap-2 bg-[#242424] flex justify-between items-center">
                        <div class="flex justify-center items-center gap-2 text-lg font-bold text-[#f8ca54]">
                            <i class="ph-duotone ph-notebook text-2xl"></i>
                            <span>{{atividade.nome_atividade}}</span>
                        </div>
                    </div>

                    <div class="p-4">
                        <div class="flex flex-col lg:flex-row gap-6">
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-textbox"></i> Descrição</p>
                                <p class="text-sm font-medium">{{atividade.descricao}}</p>
                            </div>
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-calendar-blank"></i> Data e Hora</p>
                                <p class="text-sm font-medium">{{atividade.data.strftime("%d/%m/%Y")}} - 14:30</p>
                            </div>
                        </div>
                        
                        <div class="flex flex-col p-1 lg:flex-row gap-6 mt-4">
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-tag"></i> Tipo</p>
                                <span class="px-2 py-1 bg-[#2c456c] text-white text-sm font-semibold rounded-md">
                                    Palestra
                                </span>
                            </div>
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-stairs"></i> Fase</p>
                                <span class="px-2 py-1 bg-[#7aa404] text-white text-sm font-semibold rounded-md">
                                    Fase {{atividade.fase.id_fase}}
                                </span>
                            </div>
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-package"></i> Programa</p>
                                <span class="px-2 py-1 bg-[#7aa404] text-white text-sm font-semibold rounded-md">
                                    {{atividade.plataforma}}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}


            {% for atividade in atividades_dop %}
                <!-- Atividade 2 - DOP -->
                <div class="card-atividade text-gray-300 bg-[#1a1a1a] rounded-lg border border-[#2a2a2a] transition-colors hover:border-[#f8ca54]">        
                    <div class="rounded-t-lg px-4 py-3 gap-2 bg-[#242424] flex justify-between items-center">
                        <div class="flex justify-center items-center gap-2 text-lg font-bold text-[#f8ca54]">
                            <i class="ph-duotone ph-notebook text-2xl"></i>
                            <span>{{ atividade.nome_atividade }}</span>
                        </div>
                    </div>

                    <div class="p-4">
                        <div class="flex flex-col lg:flex-row gap-6">
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-textbox"></i> Descrição</p>
                                <p class="text-sm font-medium">{{ atividade.descricao }}</p>
                            </div>
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-calendar-blank"></i> Data e Hora</p>
                                <p class="text-sm font-medium">{{atividade.data.strftime("%d/%m/%Y")}} - 10:00</p>
                            </div>
                        </div>
                        
                        <div class="flex flex-col p-1 lg:flex-row gap-6 mt-4">
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-tag"></i> Tipo</p>
                                <span class="px-2 py-1 bg-[#2c456c] text-white text-sm font-semibold rounded-md">
                                    Mentoria
                                </span>
                            </div>
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-stairs"></i> Fase</p>
                                <span class="px-2 py-1 bg-[#7aa404] text-white text-sm font-semibold rounded-md">
                                    Fase {{atividade.fase.id_fase}}
                                </span>
                            </div>
                            <div class="flex-1 space-y-2">
                                <p class="text-sm text-[#f8ca54]"><i class="ph ph-package"></i> Programa</p>
                                <span class="px-2 py-1 bg-[#cd3f07] text-white text-sm font-semibold rounded-md">
                                    {{atividade.plataforma}}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}

        </div>
    </div>
</div>

<script>
    function restartAnimation(card) {
        const el = card.querySelector(".anim");
        el.classList.remove("animate__animated", "animate__headShake");
        void el.offsetWidth;
        el.classList.add("animate__animated", "animate__headShake");
    }

    function openModal() {
        document.getElementById("infoModal").classList.remove("hidden");
        document.getElementById("infoModal").classList.add("flex");
    }

    function closeModal() {
        document.getElementById("infoModal").classList.remove("flex");
        document.getElementById("infoModal").classList.add("hidden");
    }

    function openMindmap(curso) {
        // Se for MPS ou DOP, abre o modal de atividades
        if (curso === 'MPS' || curso === 'DOP') {
            document.getElementById("modalTitulo").textContent = `Atividades - ${curso}`;
            openAtividadesModal();
        } else {
            // Para outros cursos, mantém o comportamento original do mindmap
            const modal = document.getElementById("mindmapModal");
            const frame = document.getElementById("mindmapFrame");
            frame.src = "https://exemplo.com/mindmap-" + curso.toLowerCase() + "?embed=1";
            modal.classList.remove("hidden");
            modal.classList.add("flex");
        }
    }

    function closeMindmap() {
        const modal = document.getElementById("mindmapModal");
        const frame = document.getElementById("mindmapFrame");
        frame.src = "";
        modal.classList.remove("flex");
        modal.classList.add("hidden");
    }

    function openAtividadesModal() {
        document.getElementById("atividadesModal").classList.remove("hidden");
        document.getElementById("atividadesModal").classList.add("flex");
    }

    function closeAtividadesModal() {
        document.getElementById("atividadesModal").classList.remove("flex");
        document.getElementById("atividadesModal").classList.add("hidden");
    }

    // Fechar modal ao clicar fora
    document.getElementById('atividadesModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('atividadesModal')) {
            closeAtividadesModal();
        }
    });

    // Fechar modal com ESC
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            if (!document.getElementById('atividadesModal').classList.contains('hidden')) {
                closeAtividadesModal();
            }
            if (!document.getElementById('mindmapModal').classList.contains('hidden')) {
                closeMindmap();
            }
            if (!document.getElementById('infoModal').classList.contains('hidden')) {
                closeModal();
            }
        }
    });
</script>

{% endblock %}